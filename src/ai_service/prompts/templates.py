"""
金融分析预设提示词模板

基于Al Brooks价格行为理论和技术分析，提供6类专业分析提示词。
"""

# 系统角色设定（所有提示词共用）
SYSTEM_PROMPT = """你是一位资深加密货币交易分析师，精通 Al Brooks 价格行为理论和技术分析。
你的分析基于以下原则：
- 每根K线都是信息，关注K线的位置、大小和影线
- 市场80%时间处于交易区间，20%时间处于趋势
- 始终评估多空双方的力量对比
- 风险管理优先于盈利追求
请基于提供的市场数据进行专业分析，使用简体中文回复。"""


PROMPT_TEMPLATES = {
    "comprehensive": {
        "id": "comprehensive",
        "name": "综合行情分析",
        "description": "全面分析市场结构、K线形态、技术指标、多空力量和关键价位",
        "category": "analysis",
        "template": (
            "请对 {symbol} 的 {interval} 周期进行全面分析：\n\n"
            "1. **市场结构**：当前处于趋势还是区间？HH/HL 还是 LH/LL？\n"
            "2. **K线形态**：最近K线有无关键形态（Pin Bar/吞没/内包等）？\n"
            "3. **技术指标**：RSI 超买超卖？MACD 金叉死叉？布林带位置？\n"
            "4. **多空力量**：当前谁占优势？力量是否在转换？\n"
            "5. **关键价位**：最近的支撑位和阻力位在哪里？\n"
            "6. **综合判断**：给出明确的多空倾向和置信度（0-100%）\n\n"
            "以下是当前市场数据：\n{market_context}"
        ),
    },
    "entry_timing": {
        "id": "entry_timing",
        "name": "入场时机判断",
        "description": "基于价格行为理论分析当前是否存在高概率入场机会",
        "category": "trading",
        "template": (
            "基于 Al Brooks 价格行为理论，分析 {symbol} 当前是否存在高概率入场机会：\n\n"
            "1. **信号K线**：是否出现有效的信号K线（趋势柱、反转柱）？\n"
            "2. **位置评估**：信号出现在关键位置吗（支撑阻力、均线、趋势线附近）？\n"
            "3. **确认因素**：有多少确认因素支持入场（趋势方向、指标共振、成交量）？\n"
            "4. **入场建议**：\n"
            "   - 建议方向：做多/做空/观望\n"
            "   - 入场价位\n"
            "   - 止损位置（基于最近摆动点）\n"
            "   - 目标位置（基于支撑阻力和风险回报比）\n"
            "   - 风险回报比\n\n"
            "以下是当前市场数据：\n{market_context}"
        ),
    },
    "risk_assessment": {
        "id": "risk_assessment",
        "name": "风险评估",
        "description": "全面评估当前交易风险，包括波动率、趋势健康度和仓位建议",
        "category": "risk",
        "template": (
            "请对 {symbol} 进行全面的交易风险评估：\n\n"
            "1. **波动率分析**：ATR 和布林带宽度显示当前波动率如何？\n"
            "2. **趋势健康度**：趋势是否出现衰竭信号（影线增长、实体缩小、背离）？\n"
            "3. **关键风险点**：\n"
            "   - 最近的支撑/阻力突破风险\n"
            "   - 假突破可能性\n"
            "   - 反转信号强度\n"
            "4. **仓位建议**：基于当前风险水平，建议仓位大小（轻仓/标准/重仓）\n"
            "5. **风险等级**：低/中/高/极高，并说明理由\n\n"
            "以下是当前市场数据：\n{market_context}"
        ),
    },
    "trend_analysis": {
        "id": "trend_analysis",
        "name": "趋势研判",
        "description": "深入分析趋势方向、强度、持续性和转折信号",
        "category": "analysis",
        "template": (
            "请深入分析 {symbol} 的趋势状态：\n\n"
            "1. **多周期趋势**：当前 {interval} 周期的趋势方向和阶段（初期/中期/末期）\n"
            "2. **趋势强度**：ADX 值、均线排列、MACD 位置综合判断\n"
            "3. **趋势持续性**：\n"
            "   - 回调深度是否健康（斐波那契38.2%-61.8%）？\n"
            "   - 回调K线数量是否正常？\n"
            "   - 成交量是否配合？\n"
            "4. **趋势转折信号**：是否出现以下警告？\n"
            "   - 三推形态 / 楔形\n"
            "   - 高潮反转\n"
            "   - MACD 背离\n"
            "5. **操作建议**：顺势/等待回调/准备反转\n\n"
            "以下是当前市场数据：\n{market_context}"
        ),
    },
    "support_resistance": {
        "id": "support_resistance",
        "name": "支撑阻力深度分析",
        "description": "深度分析关键价位的强度、角色转换和突破预判",
        "category": "analysis",
        "template": (
            "请对 {symbol} 的关键价位进行深度分析：\n\n"
            "1. **支撑位分析**：每个支撑位的强度、触及次数、是否被测试过\n"
            "2. **阻力位分析**：每个阻力位的强度、触及次数、突破概率\n"
            "3. **支撑阻力翻转**：是否有价位发生了角色转换？\n"
            "4. **当前价格位置**：距离最近支撑/阻力的距离和百分比\n"
            "5. **交易区间判断**：是否形成了明确的交易区间？区间宽度？\n"
            "6. **突破预判**：如果突破，最可能的方向和目标位\n\n"
            "以下是当前市场数据：\n{market_context}"
        ),
    },
    "strategy_advice": {
        "id": "strategy_advice",
        "name": "策略建议",
        "description": "基于当前市场状况提供具体的交易策略方案和仓位管理建议",
        "category": "trading",
        "template": (
            "基于当前市场状况，为 {symbol} 提供具体的交易策略建议：\n\n"
            "1. **市场环境判断**：当前适合什么类型的策略？\n"
            "   - 趋势跟踪（强趋势市场）\n"
            "   - 均值回归（区间震荡市场）\n"
            "   - 突破交易（压力积累后）\n"
            "   - 观望等待（不确定市场）\n"
            "2. **具体策略方案**：\n"
            "   - 策略名称和逻辑\n"
            "   - 入场条件（需要满足哪些条件才入场）\n"
            "   - 出场条件（止盈和止损规则）\n"
            "   - 仓位管理（建议仓位比例）\n"
            "3. **注意事项**：当前市场的特殊风险和需要关注的事件\n"
            "4. **替代方案**：如果主策略失效，备选方案是什么\n\n"
            "以下是当前市场数据：\n{market_context}"
        ),
    },
    "signal_generation": {
        "id": "signal_generation",
        "name": "交易信号生成",
        "description": "基于市场数据生成结构化交易信号（JSON格式）",
        "category": "trading",
        "template": (
            "请对 {symbol} 的 {interval} 周期进行分析，并生成交易信号。\n\n"
            "分析要点：\n"
            "1. 综合评估趋势方向、K线形态、技术指标和多空力量\n"
            "2. 判断当前应该做多(BUY)、做空(SELL)还是观望(HOLD)\n"
            "3. 给出入场价、止损价和目标价\n\n"
            "**必须**在分析末尾输出以下JSON格式的信号（用```json代码块包裹）：\n"
            "```json\n"
            '{{\n'
            '  "signal_type": "BUY或SELL或HOLD",\n'
            '  "confidence": 0.0到1.0之间的置信度,\n'
            '  "entry_price": 建议入场价,\n'
            '  "stop_loss": 止损价,\n'
            '  "take_profit": 目标价,\n'
            '  "reason": "一句话总结理由"\n'
            '}}\n'
            "```\n\n"
            "以下是当前市场数据：\n{market_context}"
        ),
    },
}
